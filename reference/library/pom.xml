<?xml version="1.0"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <artifactId>reference-base</artifactId>
    <groupId>org.sakaiproject</groupId>
    <version>10.7</version>
    <relativePath>../pom.xml</relativePath>
  </parent>
  <name>Sakai Library</name>
  <groupId>org.sakaiproject</groupId>
  <artifactId>library</artifactId>
  <organization>
    <name>University of Michigan</name>
    <url>http://sakaiproject.org/</url>
  </organization>
  <inceptionYear>2003</inceptionYear>
  <packaging>war</packaging>
  <dependencies>
    <dependency>
      <groupId>org.sakaiproject.kernel</groupId>
      <artifactId>sakai-kernel-util</artifactId>
    </dependency>
    <dependency>
      <groupId>org.sakaiproject.kernel</groupId>
      <artifactId>sakai-kernel-api</artifactId>
    </dependency>
    <dependency>
      <groupId>org.sakaiproject.kernel</groupId>
      <artifactId>sakai-component-manager</artifactId>
    </dependency>
    <dependency>
      <groupId>org.sakaiproject</groupId>
      <artifactId>sakai-fck-connector</artifactId>
      <type>war</type>
    </dependency>
  </dependencies>
  <profiles>
    <profile>
      <id>with-jsmath</id>
      <activation>
        <activeByDefault>false</activeByDefault>
        <property>
          <name>sakai.withjsmath</name>
          <value>true</value>
        </property>
      </activation>
      <dependencies>
        <dependency>
          <groupId>net.sf.jsmath</groupId>
          <artifactId>jsmath</artifactId>
          <version>3.3g</version>
          <type>war</type>
        </dependency>
        <dependency>
          <groupId>net.sf.jsmath</groupId>
          <artifactId>jsmath-fonts</artifactId>
          <version>1.3</version>
          <type>war</type>
        </dependency>
      </dependencies>
    </profile>
  </profiles>
  <build>
    <resources />
    <plugins>
      <plugin> 
        <groupId>org.jruby.plugins</groupId> 
        <artifactId>jruby-rake-plugin</artifactId> 
        <version>1.6.8</version> 
        <executions>
          <execution> 
            <id>compile-sass</id> 
            <phase>compile</phase> 
            <goals>
              <goal>rake</goal>
            </goals> 
            <configuration> 
              <script> 
                task :default do 
                  ENV['GEM_HOME'] = "#{File.dirname(__FILE__)}/../.gems"
                  ENV['BUNDLE_PATH'] = "#{File.dirname(__FILE__)}/../.gems"

                  puts "GEM_HOME=#{ENV['GEM_HOME']}"
                  puts "BUNDLE_PATH=#{ENV['BUNDLE_PATH']}"

                  puts "Installing gems"

                  cmd = ["java", "-cp", ENV['JRUBY_PARENT_CLASSPATH'], "org.jruby.Main", "--1.9", "-S", "gem", "install", "bundler", "--version", "1.6.5"]
                  puts "Running gem install with: #{cmd.inspect}"
                  system(*cmd) or raise "Oops.  Couldn't install gems: #{$!}"

                  cmd = ["java", "-cp", ENV['JRUBY_PARENT_CLASSPATH'], "org.jruby.Main", "--1.9", "-S", ".gems/bin/bundle", "install", "--gemfile", "${basedir}/src/webapp/skin/new-york-u/Gemfile"]
                  puts "Running bundle install with: #{cmd.inspect}"
                  system(*cmd) or raise "Oops.  Couldn't install gemfile: #{$!}"

                  puts "Running compass for skin/new-york-u..."
                  cmd = ["java", "-cp", ENV['JRUBY_PARENT_CLASSPATH'], "org.jruby.Main", "--1.9", ".gems/bin/compass", "compile", "-c", "${basedir}/src/webapp/skin/new-york-u/build_config.rb", "-s", "compressed", "--trace"]
                  puts "Running compass with: #{cmd.inspect}"
                  system(*cmd) or raise "Oops.  Couldn't run compass: #{$!}"
                end 
              </script> 
            </configuration> 
          </execution> 
        </executions>
      </plugin> 
    </plugins>
<!-- java source -->
  </build>
</project>
